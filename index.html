<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AnalytixAI â€“ Live Sportsbook Odds</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>

<body id="app" class="bg-[#0e1623] text-white font-sans">
  <div class="min-h-screen py-10 px-6 max-w-6xl mx-auto">

    <!-- HEADER -->
    <h1 class="text-4xl font-extrabold mb-4 tracking-tight text-center">AnalytixAI</h1>
    <p class="text-center text-gray-400 mb-10">Smarter Sports Betting Powered by Real-Time AI Odds</p>

    <!-- SPORT TOGGLE -->
    <div class="flex justify-center gap-4 mb-10">
      <button
        v-for="s in ['basketball_nba', 'football_nfl', 'baseball_mlb']"
        :key="s"
        @click="changeSport(s)"
        :class="{
          'bg-blue-600 text-white': sport === s,
          'bg-gray-700 text-gray-300 hover:bg-gray-600': sport !== s
        }"
        class="px-4 py-2 rounded transition text-sm font-semibold"
      >
        {{ s.replace('basketball_', 'NBA').replace('football_', 'NFL').replace('baseball_', 'MLB').toUpperCase() }}
      </button>
    </div>

    <!-- ODDS SECTION -->
    <div v-if="loading" class="text-center text-gray-400">Loading odds...</div>
    <div v-if="error" class="text-center text-red-400">{{ error }}</div>

    <div v-if="!loading && games.length" class="space-y-10">
      <div v-for="game in games" :key="game.id" class="glass border border-gray-700 rounded-xl p-6 shadow">
        <h2 class="text-xl font-bold mb-2">{{ game.teams[0] }} vs {{ game.teams[1] }}</h2>
        <p class="text-sm text-gray-400 mb-4">Tap to add picks</p>

        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
          <div
            v-for="(market, key) in game.bestMarkets"
            :key="key"
            @click="selectPick(`${market.name} - ${market.sportsbook}`)"
            class="cursor-pointer p-4 rounded-lg border transition transform"
            :class="{
              'border-blue-400 bg-blue-900/30 scale-105 shadow-md': selectedPicks.includes(`${market.name} - ${market.sportsbook}`),
              'border-gray-600 hover:border-blue-300 hover:bg-blue-800/20': !selectedPicks.includes(`${market.name} - ${market.sportsbook}`)
            }"
          >
            <p class="font-semibold text-white">{{ market.name }}</p>
            <p class="text-blue-300 text-xl mt-1">{{ market.price > 0 ? '+' + market.price : market.price }}</p>
            <p class="text-xs text-gray-400 mt-1">{{ market.sportsbook }}</p>
            <span class="text-[10px] text-emerald-300 mt-2 inline-block">Best Line</span>
          </div>
        </div>
      </div>
    </div>

    <!-- PICKS + MODAL -->
    <div v-if="selectedPicks.length" class="mt-12">
      <h3 class="text-xl font-semibold mb-2">Your Picks</h3>
      <ul class="list-disc text-blue-200 ml-6 mb-4">
        <li v-for="(pick, i) in selectedPicks" :key="i">{{ pick }}</li>
      </ul>
      <div class="flex gap-3">
        <button @click="openParlay" class="bg-white text-black px-4 py-2 rounded hover:bg-gray-200 transition font-semibold">
          Open Parlay
        </button>
        <button @click="clearPicks" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-400 transition text-sm">
          Clear
        </button>
      </div>
    </div>

    <!-- PARLAY MODAL -->
    <div v-if="showModal" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50">
      <div class="bg-white text-black p-6 rounded-lg max-w-md w-full">
        <h2 class="text-xl font-bold mb-2">Parlay Summary</h2>
        <p class="mb-4 text-sm text-gray-700">All picks from <strong>{{ modalBook }}</strong></p>
        <ul class="list-disc ml-6 mb-6 text-sm">
          <li v-for="(pick, i) in selectedPicks" :key="i">{{ pick }}</li>
        </ul>
        <button @click="closeModal" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-500 w-full">Close</button>
      </div>
    </div>
  </div>

  <!-- VUE SCRIPT -->
  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          sport: 'basketball_nba',
          games: [],
          selectedPicks: JSON.parse(localStorage.getItem('selectedPicks')) || [],
          loading: true,
          error: null,
          showModal: false,
          modalBook: '',
        };
      },
      methods: {
        changeSport(s) {
          this.sport = s;
          this.fetchOdds();
        },
        selectPick(pick) {
          const i = this.selectedPicks.indexOf(pick);
          if (i === -1) this.selectedPicks.push(pick);
          else this.selectedPicks.splice(i, 1);
          localStorage.setItem('selectedPicks', JSON.stringify(this.selectedPicks));
        },
        clearPicks() {
          this.selectedPicks = [];
          localStorage.removeItem('selectedPicks');
        },
        openParlay() {
          const books = this.selectedPicks.map(p => p.split(' - ')[1]);
          const uniqueBooks = [...new Set(books)];
          if (uniqueBooks.length === 1) {
            this.modalBook = uniqueBooks[0];
            this.showModal = true;
          } else {
            alert("All picks must be from the same sportsbook to open a parlay.");
          }
        },
        closeModal() {
          this.showModal = false;
        },
        async fetchOdds() {
          this.loading = true;
          this.error = null;
          const API_KEY = "3daa707ceb363f36b79f44bedc6abe2f";
          const url = `https://api.the-odds-api.com/v4/sports/${this.sport}/odds?apiKey=${API_KEY}&regions=us&markets=h2h,spreads,totals&oddsFormat=american`;

          try {
            const res = await fetch(url);
            if (!res.ok) throw new Error("Failed to fetch odds");
            const data = await res.json();

            this.games = data.map(game => {
              const bestMarkets = {};
              ["h2h", "spreads", "totals"].forEach(type => {
                game.bookmakers.forEach(book => {
                  const market = book.markets.find(m => m.key === type);
                  if (market && market.outcomes) {
                    market.outcomes.forEach(outcome => {
                      const key = `${type}-${outcome.name}`;
                      if (
                        !bestMarkets[key] ||
                        Math.abs(outcome.price) > Math.abs(bestMarkets[key].price)
                      ) {
                        bestMarkets[key] = {
                          ...outcome,
                          sportsbook: book.title,
                          market: type,
                        };
                      }
                    });
                  }
                });
              });
              return {
                id: game.id,
                teams: game.teams,
                bestMarkets,
              };
            });

            this.loading = false;
          } catch (err) {
            this.error = err.message;
            this.loading = false;
          }
        }
      },
      mounted() {
        this.fetchOdds();
      }
    }).mount('#app');
  </script>
</body>
</html>
